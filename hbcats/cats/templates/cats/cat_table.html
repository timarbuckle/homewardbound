<style>
  .hover-container {
    display: inline-block;
    cursor: pointer;
  }

  .thumbnail {
    width: 150px;
    display: block;
  }

  /* The popup starts completely hidden and has no position logic here */
  .popup-image {
    display: none;
    position: fixed; 
    z-index: 99999; /* Ensure it's above everything */
    border: 3px solid #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    max-width: 500px;
    max-height: 90vh;
    pointer-events: none;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const containers = document.querySelectorAll('.hover-container');

  containers.forEach(container => {
    const popup = container.querySelector('.popup-image');
    
    if (!popup) return; // Skip if no popup found in this container

    container.addEventListener('mousemove', (e) => {
      // Make visible
      popup.style.display = 'block';

      const gap = 20;
      const pageWidth = window.innerWidth;
      const pageHeight = window.innerHeight;
      
      // Get the size of the popup image
      const popupWidth = popup.offsetWidth;
      const popupHeight = popup.offsetHeight;

      // Calculate position
      let x = e.clientX + gap;
      let y = e.clientY + gap;

      // Flip left if it hits the right edge
      if (x + popupWidth > pageWidth) {
        x = e.clientX - popupWidth - gap;
      }

      // Shift up if it hits the bottom edge
      if (y + popupHeight > pageHeight) {
        y = e.clientY - popupHeight - gap;
      }

      // Final boundary check for top/left
      if (x < 0) x = gap;
      if (y < 0) y = gap;

      popup.style.left = x + 'px';
      popup.style.top = y + 'px';
    });

    container.addEventListener('mouseleave', () => {
      popup.style.display = 'none';
    });
  });
});
</script>

<table class="w-full text-left border-collapse">
    <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
            <th class="p-4 font-semibold text-slate-700">Cat</th>
            <th class="p-4 font-semibold text-slate-700">Status</th>
            <th class="p-4 font-semibold text-slate-700">ID</th>
            <th class="p-4 font-semibold text-slate-700">First Seen</th>
            <th class="p-4 font-semibold text-slate-700">Last Seen</th>
            <th class="p-4 font-semibold text-slate-700">Last Updated</th>
        </tr>
    </thead>
    <tbody class="divide-y divide-slate-100">
        {% for cat in cats %}
        <tr class="hover:bg-slate-50 transition">
            <td class="p-4 flex items-center gap-3 hover-container">
               <!--  <img src="{{ cat.image_url }}" class="w-30 h-30 rounded-full object-cover border border-slate-200 shadow-sm"> -->
                <img src="{{ cat.image_url }}" class="w-20 h-20 square-full object-cover border border-slate-200 shadow-sm">
                <img src="{{ cat.image_url }}" class="popup-image" alt="Full Size">
                <span class="font-medium text-slate-900">{{ cat.name }}</span>
            </td>
            <td class="p-4 text-slate-500 font-mono text-sm">{{ cat.get_status_display }}</td>
            <td class="p-4 text-slate-500 font-mono text-sm">{{ cat.image_cy }}</td>
            <td class="p-4 text-slate-600 text-sm">{{ cat.first_seen|date:"M d, Y" }}</td>
            <td class="p-4 text-slate-600 text-sm">{{ cat.last_seen|date:"M d, Y" }}</td>
            <td class="p-4 text-slate-600 text-sm italic">{{ cat.last_updated|timesince }} ago</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="p-8 text-center text-slate-400">No cats found in this category.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>