{% load static %}

<div id="cat-container" class="w-full">
    <div class="md:hidden mb-4 px-4">
        <label
            for="mobile-sort"
            class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1"
        >
            Sort Cats By
        </label>
        <select
            id="mobile-sort"
            class="w-full p-2 bg-white border border-slate-200 rounded-lg text-slate-700 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
            onchange="
                htmx.ajax('GET', this.value, {
                    target: '#cat-table',
                    swap: 'innerHTML',
                })
            "
        >
            <option
                value="?filter={{ current_filter }}&sort=name&sort_order=asc"
                {%
                if
                current_sort=""
                ="name"
                %}selected{%
                endif
                %}
            >
                Name
            </option>
            <option
                value="?filter={{ current_filter }}&sort=status&sort_order=asc"
                {%
                if
                current_sort=""
                ="status"
                %}selected{%
                endif
                %}
            >
                Status
            </option>
            <option
                value="?filter={{ current_filter }}&sort=age&sort_order=desc"
                {%
                if
                current_sort=""
                ="age"
                %}selected{%
                endif
                %}
            >
                Age (Newest)
            </option>
            <option
                value="?filter={{ current_filter }}&sort=intake_date&sort_order=desc"
                {%
                if
                current_sort=""
                ="intake_date"
                %}selected{%
                endif
                %}
            >
                Intake Date
            </option>
            <option
                value="?filter={{ current_filter }}&sort=location&sort_order=asc"
                {%
                if
                current_sort=""
                ="location"
                %}selected{%
                endif
                %}
            >
                Location
            </option>
        </select>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse" id="cat-table">
            <thead
                class="hidden md:table-header-group bg-slate-50 border-b border-slate-200"
            >
                <tr>
                    <th class="p-4 font-semibold text-slate-700">
                        <a class="cursor-pointer"
                           hx-get="?filter={{ current_filter }}&sort=name&sort_order={% if current_sort == 'name' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}"
                           hx-target="#cat-table"
                           hx-swap="innerHTML">
                            Cat
                            {% if current_sort == 'name' %}
                                {% if current_sort_order == 'asc' %}↓{% else %}↑{% endif %}
                            {% endif %}
                        </a>
                    </th>
                    <th class="p-4 font-semibold text-slate-700">
                        <a class="cursor-pointer"
                            hx-get="?filter={{ current_filter }}&sort=age&sort_order={% if current_sort == 'age' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}"
                            hx-target="#cat-table"
                            hx-swap="innerHTML">
                            Age
                            {% if current_sort == 'age' %}
                                {% if current_sort_order == 'asc' %}↑{% else %}↓{% endif %}
                            {% endif %}
                        </a>
                    </th>
                    <th class="p-4 font-semibold text-slate-700">
                        <a class="cursor-pointer"
                            hx-get="?filter={{ current_filter }}&sort=status&sort_order={% if current_sort == 'status' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}"
                            hx-target="#cat-table"
                            hx-swap="innerHTML">
                            Status
                            {% if current_sort == 'status' %}
                                {% if current_sort_order == 'asc' %}↓{% else %}↑{% endif %}
                            {% endif %}
                        </a>
                    </th>
                    <th
                        class="p-4 font-semibold text-slate-700 whitespace-nowrap"
                    >
                        <a
                            class="cursor-pointer"
                            hx-get="?filter={{ current_filter }}&sort=intake_date&sort_order={% if current_sort == 'intake_date' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}"
                            hx-target="#cat-table"
                            hx-swap="innerHTML">
                            Intake Date
                            {% if current_sort == 'intake_date' %}
                                {% if current_sort_order == 'asc' %}↓{% else %}↑{% endif %}
                            {% endif %}
                        </a>
                    </th>
                    <th class="p-4 font-semibold text-slate-700">Sex</th>
                    <th class="p-4 font-semibold text-slate-700">Breed</th>
                    <th class="p-4 font-semibold text-slate-700">Location</th>
                </tr>
            </thead>

            <tbody
                id="cat-table-body"
                class="divide-y divide-slate-100 block md:table-row-group"
            >
                {% for cat in cats %}
                <tr class="hover:bg-slate-50 transition">
                    <td class="p-4 md:hidden">
                        <div class="flex items-start gap-4">
                            <div class="w-28 text-center flex-shrink-0">
                                <img
                                    src="/media/{{ cat.image.name }}"
                                    class="w-28 h-28 rounded-xl object-cover border border-slate-200 shadow-sm"
                                    alt="{{ cat.name }}"
                                />
                                <span
                                    class="font-bold text-lg text-slate-900 mt-2"
                                    >{{ cat.name }}</span
                                >
                            </div>
                            <div class="flex-1">
                                <div class="grid grid-cols-2 gap-y-2 text-sm">
                                    <div class="text-slate-500">Status</div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.get_status_display }}
                                    </div>

                                    <div class="text-slate-500">Age</div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.age }}
                                    </div>

                                    <div class="text-slate-500">Breed</div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.clean_breed }}
                                    </div>

                                    <div class="text-slate-500">Sex</div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.sex }}
                                    </div>

                                    <div class="text-slate-500">
                                        Intake Date
                                    </div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.intake_date|date:"M d, Y" }}
                                    </div>

                                    <div class="text-slate-500">Location</div>
                                    <div
                                        class="text-slate-900 font-medium text-right"
                                    >
                                        {{ cat.location }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>

                    <td class="hidden md:table-cell p-4">
                        <div class="flex items-center gap-4">
                            <img
                                src="/media/{{ cat.image.name }}"
                                class="w-24 h-24 rounded-xl object-cover border border-slate-200 shadow-sm"
                                alt="{{ cat.name }}"
                            />
                            <div>
                                <span class="font-bold text-lg text-slate-900"
                                    >{{ cat.name }}</span
                                >
                            </div>
                        </div>
                    </td>
                    <td class="hidden md:table-cell p-4 text-slate-600 text-sm">
                        {{ cat.age }}
                    </td>
                    <td
                        class="hidden md:table-cell p-4 text-slate-500 font-mono text-sm"
                    >
                        {{ cat.get_status_display }}
                    </td>
                    <td class="hidden md:table-cell p-4 text-slate-600 text-sm">
                        {{ cat.intake_date|date:"M d, Y" }}
                    </td>
                    <td
                        class="hidden md:table-cell p-4 text-slate-500 font-mono text-sm"
                    >
                        {{ cat.sex }}
                    </td>
                    <td
                        class="hidden md:table-cell p-4 text-slate-500 font-mono text-sm"
                    >
                        {{ cat.clean_breed }}
                    </td>
                    <td
                        class="hidden md:table-cell p-4 text-slate-500 font-mono text-sm"
                    >
                        {{ cat.location }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="p-8 text-center text-slate-400">
                        No cats found in this category.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
